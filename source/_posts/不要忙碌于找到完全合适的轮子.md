---
title: 完全符合需求的轮子
date: 2020-03-05 17:30:45
tags:
  - 技术杂谈
---

## 思路
找不到完全合适的轮子要怎么办？如果发现一个开源依赖非常靠近你的需求，但是仅仅有一些地方不满足，无法使用，你会怎么选择？先说结论，我们可以大胆fork一份代码，然后根据自己的需求改造之后发布一个增强包给自己使用。

## 理由
- 工作中难免遇到轮子差一点就能满足需求的情况
- 完全重新造轮子成本过高
- 修改原来的轮子的成本只是阅读源码和新功能测试
- 通过在社区提建议的方式难以快速响应业务需求

## 例子
之前我做一个cli工具优化的时候，需要使用yeoman的update-notifier包的功能进行依赖升级终端提醒，但是这个包有个缺点，就是只支持默认使用npm官方的registry。但是我的生产环境用到的registry又恰恰是基于cnpm搭建的私有registry。

很自然，摆在我面前有两个方案
1. 参考update-notifier思路自己写一个新轮子
2. 给update-notifier加一个option，支持registry传参

碰巧我当时发现团队内也有同学遇到这个需求，他是直接手写方法实现了这个需求。只是我知道有update-notifier这个包，基于这个情况一看便知道，肯定是第二个方案成本最低。那为什么会有第一个方案的出现呢？有时候难免在社区轮子不满足需求的情况下，会放弃搜索而选择自己实现，有时候这是一个不错的选择，因为很有可能你的需求是多个依赖东拼西凑才能解决的。而我眼前的需求很清晰，只是增加一个registry参数的问题，那就要果断去用第二个方案解决问题。

定下方案之后，我付出的时间也很少。只是聚焦于update-notifier的retistry参数如何传递，而不用关心它核心原理（比较版本号并做出升级提示的主流程）。现在看来也是在工作中性价比很高的操作。

我已经将改动的代码上传到[github](https://github.com/skyline-123/update-notifier/blob/master/index.js), 其实只要你想，总是可以让工作变得相对而言更轻松。

## 归纳
遇到需求的时候，除了一把梭自己全部实现之外，我按解决问题的顺序排序了如下方案：
1. 找到合适的轮子，用它
2. 找到部分合适的轮子，改它
3. 找不到一个轮子能满足需求，造它

我这篇文章的核心其实就是第二点，找到部分合适的轮子，改它。也就是上传一个增强包到自己的npm服务端的事情，开心去改造吧，没必要浪费时间去找所谓完美合适的轮子。
